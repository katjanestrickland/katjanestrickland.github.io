---
title: "this"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>
<style type="text/css">
.title {
  display: none;
}

#getting-started img {
  margin-right: 1px;
}

</style>

<div class="row" style="padding-top: 30px;">
<div class="col-sm-6">

# Asymmetric Costs in Random Forest

Central to the debate of ethical algorithm design is a consideration of mis-classification costs for supervised learning methods. By building in asymmetric costs through sampling, machine learning engineers can take heed of policy makers' desired cost-ratios. In this project, I investigate how sample size selection affects cost asymmetry. I build a random forest algorithm to predict death rates of coronavirus patients in South Korea using the <a href = "https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge/" target = "_blank"> Kaggle </a>COVID-19 Open Research Dataset.


### Technical

Data cleaning: tidyverse </br>
Random Forest: randomforest() package

### Sample

Sample code and charts below. See <a href = "https://github.com/katjanewilson/COVID-19-Random-Forest.git" target = "_blank"> GitHub repo </a> for full code and analysis.



```{r echo=TRUE, message=FALSE}
#install.packages("randomForest")
#install.packages("kableExtra")
library(randomForest)
library(kableExtra)
library(tidyverse)
# load("data/coronavirus_data.Rdata")
# set.seed(222)
# rf <- randomForest(outcome~Sex + Age + Province + Source +
#                     Order, data=coronavirus_data,
#                    importance = TRUE,
#                    sampsize = c(21,12,26))
dataframe <- read.csv('data/COVID_random_forest_table.csv')
names(dataframe)[1] <- "Outcome1"
names(dataframe)[2] <- "Outcome2"
names(dataframe)[3] <- "Outcome3"
names(dataframe)[4] <- "Classification Error"
dataframe <- dataframe %>%
  mutate(`Classification Error` = round(`Classification Error`, 2))
dataframe <- dataframe %>%
  mutate(`Classification Error` = cell_spec(`Classification Error`, "html", color = ifelse(`Classification Error`>
                                                     0.5, "green",
                                                   "black"))) %>%
  mutate_if(is.numeric, function(x) {
    cell_spec(x, bold = T)
  }) %>%
  mutate(position = c("top", "top", "top"),
         text = c("84% Classification Accuracy", "54% Classification Accuracy", "87% Classification Accuracy"),
         name = c("0.16", "0.46", "0.13"))
dataframe <- dataframe %>%
  mutate(position2 = c("top", "top", "top"),
         text2 = c("In response to policy makers' request that a false negative in death classification be 20 times worse than a false positive release classification, deceased values are oversampled, at 21 out of 32, to avoid false positive releases. Due to a large imbalance in the outcome distribution, however, (less than 2% of patients die from the disease), a strict adherance to this cost ratio affects the cost ratios of the other categories.", "The cost ratio of a false negative death to a false positive isolation is less severe, at 10:1. A larger ratio of 20:1 is achieved due to the high number of people isolated, and under-sampling from this parameter.", "A false negative release is about as risky as a false positive isolation, according to policy makers. The ratio intended was 2:1, and the actual result form sampling was 1.2:1. This tradeoff is the decision with the least repercussions, according the stakeholders"),
         name2 = c("Deceased", "Released", "Isolated"))
dataframe$`Classification Error` <- cell_spec(
  dataframe$name,
  popover = spec_popover(
    content = dataframe$text,
    title = NULL,  
    position = dataframe$position
  ))
dataframe$`Confusion Table`<- cell_spec(
  dataframe$name2,
  popover = spec_popover(
    content = dataframe$text2,
    title = NULL,  
    position = dataframe$position2
  ))
dataframe <- dataframe %>%
  select(`Confusion Table`, Outcome1, Outcome2, Outcome3, `Classification Error`)
kable(dataframe, escape = FALSE, caption = "Table 1 classifies the OOB estimates. The algorithm's forecasting accuracy improves upon all previously stated baseline percentage forecasts, which were 1.51%, 85.6%, and 12.93% for the deceased, released, and isolated, respectively. <strong>Scroll over the table</strong> to learn more about how sampling affects cost ratios.") %>%
  kable_styling("striped", full_width = FALSE)


```

</script>


