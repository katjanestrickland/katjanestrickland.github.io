---
title: "this"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>
<style type="text/css">
.title {
  display: none;
}

#getting-started img {
  margin-right: 1px;
}

</style>

<div class="row" style="padding-top: 30px;">
<div class="col-sm-6">

# Asymmetric Costs in Random Forest

Central to the debate of ethical algorithm design is a consideration of mis-classification costs for supervised learning methods. By building in asymmetric costs through sampling, machine learning engineers can take heed of policy makers' desired cost-ratios. In this project, I investigate how sample size selection affects cost asymmetry. I build a random forest algorithm to predict death rates of coronavirus patients in South Korea using the <a href = "https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge/" target = "_blank"> Kaggle </a>COVID-19 Open Research Dataset.


### Technical

Data cleaning: tidyverse </br>
Random Forest: randomforest() package

### Sample

Sample code and charts below. See <a href = "https://github.com/katjanewilson/COVID-19-Random-Forest.git" target = "_blank"> GitHub repo </a> for full code and analysis.



```{r echo=TRUE, message=FALSE}
#install.packages("randomForest")
#install.packages("kableExtra")
library(randomForest)
library(kableExtra)
library(tidyverse)
load("data/coronavirus_data.Rdata")
rf <- randomForest(outcome~Sex + Age + Province + Source +
                    Order, data=coronavirus_data,
                   importance = TRUE,
                   sampsize = c(21,12,26))
dataframe <- as.data.frame(rf$confusion)
names(dataframe)[1] <- "Outcome1"
names(dataframe)[2] <- "Outcome2"
names(dataframe)[3] <- "Outcome3"
names(dataframe)[4] <- "Classification Error"
dataframe <- dataframe %>%
  mutate(`Classification Error` = round(`Classification Error`, 2))
dataframe <- dataframe %>%
  mutate(`Classification Error` = cell_spec(`Classification Error`, "html", color = ifelse(`Classification Error`>
                                                     0.5, "green",
                                                   "black"))) %>%
  mutate_if(is.numeric, function(x) {
    cell_spec(x, bold = T)
  }) %>%
  mutate(position = c("top", "top", "top"),
         text = c("text about the cost ratio", "text about the cost ratio", "text about the cost ratio"),
         name = c("0.19", "0.87", "0.04"))

dataframe$`Classification Error` <- cell_spec(
  dataframe$name,
  popover = spec_popover(
    content = dataframe$text,
    title = NULL,  
    position = dataframe$position
  ))
dataframe <- dataframe %>%
  select(Outcome1, Outcome2, Outcome3, `Classification Error`)
kable(dataframe, escape = FALSE) %>%
  kable_styling("striped", full_width = FALSE)



###variable importance plots
par(mfrow = c(2,2))

varImpPlot(rf, class = 1, type = 1, scale = FALSE, 
           main = "Fig 1.1: Forecasting Importance Plot for Deceased")
varImpPlot(rf, type = 1, scale = FALSE, 
           main = "Fig 1.2: Forecasting Importance Plot Averaged for All")
varImpPlot(rf, class = 2, type = 1, scale = FALSE, 
           main = "Fig 1.3: Forecasting Importance Plot for Released")
varImpPlot(rf, class = 3, type = 1, scale = FALSE, 
           main = "Fig 1.4: Forecasting Importance Plot for Isolated")

```

</script>


