<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>machine_learning.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Kat Wilson</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="cv.html">CV</a>
</li>
<li>
  <a href="wharton_analytics_fellows.html">Wharton Analytics Fellows</a>
</li>
<li>
  <a href="machine_learning.html">Machine Learning</a>
</li>
<li>
  <a href="data_vis.html">Data Visualization</a>
</li>
<li>
  <a href="causal_inference.html">Causal Inference</a>
</li>
<li>
  <a href="other.html">Other</a>
</li>
<li>
  <a href="https://github.com/katjanewilson">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
<li>
  <a href="https://towardsdatascience.com/@katjanewilson">
    <span class="fa fa-medium"></span>
     
    
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/kat-wilson-920256139/">
    <span class="fa fa-linkedin"></span>
     
    
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<hr />
<div id="covid-19-open-research-data-challenge" class="section level2">
<h2>COVID-19 Open Research Data Challenge</h2>
<hr />
<div class="row">
<div class="col-sm-6">
<h4 id="overview">Overview</h4>
<p>Central to the debate of ethical algorithm design is a consideration of mis-classification costs for supervised learning methods. By building in asymmetric costs through sampling, machine learning engineers can take heed of policy makers’ desired cost-ratios. In this project, I investigate how sample size selection affects cost asymmetry. I build a random forest algorithm to predict death rates of coronavirus patients in South Korea using the <a href = "https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge/" target = "_blank"> Kaggle </a>COVID-19 Open Research Dataset.</p>
<h4 id="technical">Technical</h4>
<p>Data cleaning: tidyverse </br> Random Forest: R (randomforest)</p>
</div>
<div class="col-sm-6">
<p><img src="images/covid.png" width="150" /></p>
</div>
</div>
<hr />
<div class="row">
<div class="col-sm-6">
<h4 id="sample">Sample</h4>
<p>Sample code and charts below. See <a href = "https://github.com/katjanewilson/COVID-19-Random-Forest.git" target = "_blank"> GitHub repo </a> for full code and analysis.</p>
</div>
<div class="col-sm-6">



<pre class="r"><code>## sample cleaning code
rm(list = ls())
Patient &lt;- read.csv(&quot;PatientInfo.csv&quot;, na.strings = c(&quot;&quot;,NA))
save(Patient, file = &quot;Patient.rdata&quot;)
Patient$ID &lt;- as.numeric(as.character(Patient$patient_id))
class(Patient$sex)
Patient$sex
Patient$sex[is.na(Patient$sex)]&lt;- &quot;absent&quot;
Patient$Age &lt;- as.numeric(Patient$age)
data_new &lt;- Patient %&gt;%
  mutate(sex = ifelse(is.na(Sex), &quot;absent&quot;, Sex)) %&gt;%
  mutate(age = ifelse(is.na(age), &quot;20s&quot;, age)) %&gt;%
  mutate(Age = case_when(age %in% c(1:10) ~ &quot;10s&quot;,
                         age %in% c(11:20) ~ &quot;20s&quot;,
                         age %in% c(21:30) ~ &quot;30s&quot;,
                         age %in% c(31:40) ~ &quot;40s&quot;,
                         age %in% c(41:50) ~ &quot;50s&quot;,
                         age %in% c(51:60) ~ &quot;60s&quot;,
                         age %in% c(61:70) ~ &quot;70s&quot;,
                         age %in% c(71:80) ~ &quot;80s&quot;,
                         age %in% c(81:120) ~ &quot;90s&quot;)) %&gt;%
  mutate(Province = ifelse(is.na(province), &quot;absent&quot;, province)) %&gt;%
  mutate(Source = ifelse(is.na(infection_case), &quot;absent&quot;, infection_case)) %&gt;%
  mutate(Order = ifelse(is.na(infection_order), &quot;4&quot;, infection_order)) %&gt;%
  mutate(confirmed_date = ifelse(is.na(confirmed_date), &#39;2020-02-20&#39;, confirmed_date)) %&gt;%
  mutate(State3 = ifelse(is.na(state), &#39;deceased&#39;, state)) %&gt;%
  mutate(State2 = as.factor(ifelse(State3 == &quot;deceased&quot;, &quot;Died&quot;, &quot;Lived&quot;))) %&gt;%
  mutate(State2 = ifelse(is.na(State2), &quot;Lived&quot;, State2)) %&gt;%
  mutate(birthyear = ifelse(is.na(birth_year), 1960, birth_year)) %&gt;%
  mutate(Age = ifelse(is.na(Age), &quot;20s&quot;, Age))

## sample random forest code
rf &lt;- randomForest(outcome~Sex + Age + Province + Source +
                    Order, data=coronavirus_data,
                   importance = TRUE,
                   sampsize = c(21,12,26))
print(rf)
###variable importance plots
par(mfrow = c(2,2))

varImpPlot(rf, class = 1, type = 1, scale = FALSE, 
           main = &quot;Fig 1.1: Forecasting Importance Plot for Deceased&quot;)
varImpPlot(rf, type = 1, scale = FALSE, 
           main = &quot;Fig 1.2: Forecasting Importance Plot Averaged for All&quot;)
varImpPlot(rf, class = 2, type = 1, scale = FALSE, 
           main = &quot;Fig 1.3: Forecasting Importance Plot for Released&quot;)
varImpPlot(rf, class = 3, type = 1, scale = FALSE, 
           main = &quot;Fig 1.4: Forecasting Importance Plot for Isolated&quot;)

####Partial plots
part1&lt;- partialPlot(rf, pred.data = coronavirus_data, x.var = &quot;Age&quot;,
                    rug = T, which.class = 1)
part2&lt;- partialPlot(rf, pred.data = coronavirus_data, x.var = &quot;Age&quot;,
                    rug = T, which.class = 2)
part3&lt;- partialPlot(rf, pred.data = coronavirus_data, x.var = &quot;Age&quot;,
                    rug = T, which.class = 3)
par(mfrow = c(2,2))

#tranform the logs back to probablity
scatter.smooth(part1$x, part1$y, xlab = &quot;Age&quot;,
               ylab = &quot;Centered Log Odds of Death&quot;, main = &quot;Fig 2.1: Partial Dependence Plot for Death on Age&quot;)
##how the other plots change based on outcome
scatter.smooth(part2$x, part2$y, xlab = &quot;Age&quot;,
               ylab = &quot;Centered Log Odds of Released&quot;, main = &quot;Fig 2.2: Partial Dependence Plot for Released on Age&quot;)
scatter.smooth(part3$x, part3$y, xlab = &quot;Age&quot;,
               ylab = &quot;Centered Log Odds of Isolated&quot;, main = &quot;Fig 2.3: Partial Dependence Plot for Isolated on Age&quot;)

par(mfrow = c(2,2))
part2 &lt;- partialPlot(rf, pred.data = coronavirus_data,
                     x.var = Sex, reg = T, prob = T,which.class = 1 ,
                       main = &quot;Fig 3.1: Partial Dependence Plot for Death on Sex&quot;,
                     xlab = &quot;Sex&quot;, ylab = &quot;Centered Log Odds of Death&quot;)
part2
part2 &lt;- partialPlot(rf, pred.data = coronavirus_data,
                     x.var = Order, reg = T, prob = T,which.class = 1 ,
                     main = &quot;Fig 3.2: Partial Dependence Plot for Death on Order&quot;,
                     xlab = &quot;Order&quot;, ylab = &quot;Centered Log Odds of Death&quot;)
part2
part2 &lt;- partialPlot(rf, pred.data = coronavirus_data,
                     x.var = Province, reg = T, prob = T,which.class = 1 ,
                     main = &quot;Fig 3.3: Partial Dependence Plot for Death on Province&quot;,
                     xlab = &quot;Province&quot;, ylab = &quot;Centered Log Odds of Death&quot;)
part2
part2 &lt;- partialPlot(rf, pred.data = coronavirus_data,
                     x.var = Source, reg = T, prob = T,which.class = 1 ,
                     main = &quot;Fig 3.4: Partial Dependence Plot for Death on Source&quot;,
                     xlab = &quot;Source&quot;, ylab = &quot;Centered Log Odds of Death&quot;)
part2
table(coronavirus_data$Source, coronavirus_data$State3)
par(mfrow = c(2,2))
m1&lt;- randomForest::margin(rf)
m1
hist(m1, breaks = 30, main = &quot;Fig 4.1: Histogram of Votes over Trees&quot;, xlab = &quot;Margin&quot;)
m2 &lt;- subset(m1, names(m1) == 1)
m2
hist(m2, breaks = 30, main = &quot;Fig 4.2: Margin for Death classification&quot;, xlab = &quot;Votes for Deceased&quot;)
m2
m3 &lt;- subset(m1, names(m1) == 2)
hist(m3,breaks = 30, main = &quot;Fig 4.3: Margin for Released classification&quot;, xlab = &quot;Votes for Released&quot;)
m3 &lt;- subset(m1, names(m1) == 3)
hist(m3, breaks = 30, main = &quot;Fig 4.4: Margin for Isolated classification&quot;, xlab = &quot;Votes for Isolated&quot;)</code></pre>
<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Table 1 classifies Out-of-Bag estimates for the random forest. The algorithm’s forecasting accuracy improves upon all previously stated baseline percentage forecasts, which were 1.51%, 85.6%, and 12.93%, for the deceased, isolated, and released, respectively. <strong>Hover over the confusion table</strong> to learn more about how sampling affects cost ratios.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Confusion Table
</th>
<th style="text-align:left;">
Outcome1
</th>
<th style="text-align:left;">
Outcome2
</th>
<th style="text-align:left;">
Outcome3
</th>
<th style="text-align:left;">
Classification Error
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<span style="     " data-toggle="popover" data-trigger="hover" data-placement="top" data-content="In response to policy makers&#39; request that a false negative in death classification be 20 times worse than a false positive release classification, deceased values are oversampled, at 21 out of 32, to avoid false positive releases. Due to a large imbalance in the outcome distribution, however, (less than 2% of patients die from the disease), a strict adherance to this cost ratio affects the ability to meet desired cost ratios in other categories.">Deceased</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">26</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">1</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">5</span>
</td>
<td style="text-align:left;">
<span style="     " data-toggle="popover" data-trigger="hover" data-placement="top" data-content="84% Classification Accuracy">0.16</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span style="     " data-toggle="popover" data-trigger="hover" data-placement="top" data-content="The intended cost ratio of a false negative death to a false positive isolation is set at 10:1. A larger ratio of 20:1 is achieved due to the high number of people isolated, and under-sampling from this parameter.">Released</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">10</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">149</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">115</span>
</td>
<td style="text-align:left;">
<span style="     " data-toggle="popover" data-trigger="hover" data-placement="top" data-content="54% Classification Accuracy">0.46</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span style="     " data-toggle="popover" data-trigger="hover" data-placement="top" data-content="A false negative release is about as risky as a false positive isolation, according to policy makers. The ratio intended was 2:1, and the actual result, with sampling, was 1.2:1.">Isolated</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">105</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">130</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">1578</span>
</td>
<td style="text-align:left;">
<span style="     " data-toggle="popover" data-trigger="hover" data-placement="top" data-content="87% Classification Accuracy">0.13</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
</div>
<div id="los-angeles-census-tracts" class="section level2">
<h2>Los Angeles Census Tracts</h2>
<hr />
<div class="row">
<div class="col-sm-6">
<h4 id="overview-1">Overview</h4>
<p>A hard to swallow assumption in the linear model framework is that a particular feature will change at the same rate across all values for a given variable. General Additive Models (GAM) give analysts the opportunity to identify nonlinear changes between covariates and the dependent variable. These nonparametric models can suffer from poor interpretability, however, and strong assumptions will have to be made regarding the data generation process. In a project using census data in the city of Los Angeles, gam models identify outlier trends in homeless individuals, yet they also reveal limitations of the loess smoother at upper boundaries of data.</p>
<h4 id="technical-1">Technical</h4>
<p>Data cleaning: tidyverse </br> General Additive Models: mgc, mgcViz and gam</p>
</div>
<div class="col-sm-6">
<p><img src="images/census.jpg" width="200" /></p>
</div>
</div>
<hr />
<div class="row">
<div class="col-sm-6">
<h4 id="sample-1">Sample</h4>
<p>Sample code and charts below. See <a href = "https://github.com/katjanewilson/Generalized-Additive-Model/blob/master/Code" target = "_blank"> GitHub repo </a> for full code and analysis.</p>
</div>
<div class="col-sm-6">



<pre class="r"><code>library(tidyverse)
library(DataExplorer)
library(gridExtra)

#inspect data
load(&quot;data/NewHomeless.rdata&quot;)
homeless &lt;- homeless

#count the missing data values
# sapply(homeless, function(x) sum(is.na(x)))

# #inspect missing values
# missing &lt;- homeless %&gt;%
#   filter(is.na(PropVacant))

#impute the missing data
homeless[is.na(homeless)] = 0

#cleanign up the mis coded
# Adjust values of PropMinority mis-coded as &quot;100&quot; instead of &quot;1.0&quot;
library(dplyr)
homeless &lt;- mutate_at(homeless, vars(PropMinority), list(~ ifelse( . &gt; 1.0, 1.0, .)))

# Convert values of &quot;Pct&quot; variables to be in decimal scale
homeless &lt;- mutate_at(homeless, vars(PctResidential:PCTIndustrial), list(~ .*.01))

# Recode four NAs in PropVacant as zero owing to how few residential dwellings exist in
# those tracts
homeless &lt;- mutate_at(homeless, vars(PropVacant), list(~ ifelse(is.na(.)==T, 0, .)))

#recode the industrial
homeless &lt;- homeless %&gt;%
  mutate(Industrial = ifelse(PCTIndustrial &gt;0, 1, 0))

####################
#Step 2: Univariate Statistics

library(DataExplorer)
#pairs
# pairs(homeless)
# #correlation
# plot_correlation(homeless, type = &#39;continuous&#39;,&#39;Review.Date&#39;)

#Street Total

par(mfrow = c(1,2))
p1 &lt;- ggplot(aes(StreetTotal), data = homeless) +
  geom_histogram(binwidth = 6) +
  geom_vline(xintercept = mean(homeless$StreetTotal), size = 0.8)
p2 &lt;- ggplot(aes(MedianIncome), data = homeless) +
  geom_histogram(bins = 50) +
  geom_vline(xintercept = mean(homeless$MedianIncome), colour = &quot;pink&quot;, size = 0.8)
#Prop Vacant
p3 &lt;- homeless %&gt;%
  ggplot(aes(PropVacant)) +
  geom_histogram(bins = 40) +
  geom_vline(xintercept = mean(homeless$PropVacant), colour = &quot;pink&quot;)
#Prop Minority
p4 &lt;- homeless %&gt;%
  ggplot(aes(PropMinority)) +
  geom_histogram(bins = 50) +
  geom_vline(xintercept = mean(homeless$PropMinority), colour = &quot;pink&quot;)
#Pct Residential
p5 &lt;- homeless %&gt;%
  ggplot(aes(PctResidential)) +
  geom_histogram(bins = 50) +
  geom_vline(xintercept = mean(homeless$PctResidential), colour = &quot;pink&quot;)
#PctCommercial
p6 &lt;- homeless %&gt;%
  ggplot(aes(PctCommercial)) +
  geom_histogram(bins = 50) +
  geom_vline(xintercept = mean(homeless$PctCommercial), colour = &quot;pink&quot;)
#PctIndustrial
p7 &lt;- homeless %&gt;%
  ggplot(aes(PCTIndustrial)) +
  geom_histogram(bins = 50) +
  geom_vline(xintercept = mean(homeless$PCTIndustrial), colour = &quot;pink&quot;)
library(gridExtra)
grid.arrange(p1, p2, p3, p4, p5, p6, p7, nrow = 3)</code></pre>
<p><img src="machine_learning_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>#set seed at 4000
# Bring in data and create initial training and test datasets
set.seed(4000)
df &lt;- homeless
index &lt;- sample(1:nrow(df), (nrow(df))/2, replace = F) 
Train &lt;- na.omit(df[index,]) # Training data
Test &lt;- na.omit(df[-index,]) # Test data
##coming to the right model:
library(leaps)
All1 &lt;- regsubsets(StreetTotal ~ MedianIncome + PropMinority +
                     PropVacant+
                     PctResidential+
                     PCTIndustrial +
                     PctCommercial +
                     Industrial, data = Train)
# All1
# summary(All1)

Model2 &lt;- lm(StreetTotal ~  
               PropVacant+
               Industrial +
               (PropVacant:Industrial), data = Train)
# summary(Model2)

## Generalization error ##
# Specify a model on the testing data 
Model2 &lt;- lm(StreetTotal ~  
               PropVacant+
               Industrial +
               (PropVacant:Industrial), data = Test)
# summary(Model2)
#estimate the fitted values on the testing data, and the generalization error
preds &lt;- predict(Model2, newdata = Test) # New fitted values derived from the test data
GE &lt;- var(Test$StreetTotal - preds) # Estimate of generalization error (the variance of the residuals when 
# GE
# sqrt(GE)
# Bootstrap a confidence interval for the generalization error 
bootstrap_genError &lt;-
  function(x) {
    bootstrapped_genErrors &lt;- 0
    for (i in 1:1000) {
      index &lt;- sample(1:nrow(x), nrow(x), replace = T)
      sample_Test &lt;- x[index,]
      sample_Test_preds &lt;- predict(Model2, newdata = sample_Test)
      bootstrapped_genErrors[i] &lt;- var(sample_Test$StreetTotal - sample_Test_preds)
    }
    return(bootstrapped_genErrors)
  }

bootstrap_results_ge &lt;- bootstrap_genError(Test)

# Check generalization error bootstrap results
# mean(bootstrap_results_ge, na.rm = T)
# summary(bootstrap_results_ge)
# hist(bootstrap_results_ge, breaks = 20) 
# qqnorm(bootstrap_results_ge)
# sd(bootstrap_results_ge)
# quantile(bootstrap_results_ge, probs = c(.025,.975))
# plot(density(bootstrap_results_ge))
# qqnorm(bootstrap_results_ge)
#use robust sandwich standard errors in the sandwich package
# install.packages(&quot;sandwich&quot;)
library(sandwich)
# vcovHC(Model2, type = &quot;HC&quot;)
# sandwich_se &lt;- diag(vcovHC(Model2, type = &quot;HC1&quot;))
# sqrt(sandwich_se)
#then can get the confidence interval limits of these
# coef(Model2) - 1.96*sandwich_se
# coef(Model2) + 1.96*sandwich_se

library(gam)
library(mgcv)
library(leaps)

homeless2 &lt;- homeless %&gt;%
  filter(MedianIncome &gt; 60000 &amp; PropVacant &lt; .10)

##MODEL 1
out3 &lt;- gam(StreetTotal ~
              s(PCTIndustrial) +
              s(PctCommercial) +
              s(PropVacant) +
              s(MedianIncome), data = homeless, family = gaussian)
# summary(out3)
par(mfrow=c(2,2))
# plot(out3, residual = T, cex = 1, pch = 19, shade = T, shade.col = &quot;light blue&quot;,
#      col = &quot;#FAD7A0&quot;)
library(mgcViz)
b&lt;- getViz(out3)
o &lt;- plot( sm(b, 1) )
o + l_fitLine(colour = &quot;#FAD7A0&quot;) + l_rug(mapping = aes(x=x, y=y), alpha = 0.9) +
  l_ciLine(mul = 5, colour = &quot;light blue&quot;, linetype = 2) + 
  l_points(shape = 19, size = 1, alpha = 0.7, color = &quot;light blue&quot;) + theme_classic()</code></pre>
<p><img src="machine_learning_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
